!function(t){function e(){v={color:"#780011",webcamElm:document.getElementById("webcam"),webcamMirror:document.getElementById("webcamMirror"),trackedElm:document.getElementById("tracked"),frequencyElm:!1,noteElm:!1,cOffset:20,sizeOffset:5,useTimbre:!1}}function i(){var t=v.webcamElm,e=function(t){alert("Webcam error!",t)};navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(e){t.srcObject=e,t.play()})}function r(t,e){for(var i in e)t[i]=e[i];return t}function o(t,e){var i=String(t);if(i.length<e)for(var r=e-i.length,o=0;o<r;o++)i='<span class="inactive">0</span>'+i;return i}function n(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i=t%12,r=Math.floor(t/12)-1,o=e[i];return o+(o.length<2?"-":"")+r}function h(t){return Math.round(12*Math.log(t/440)+69)}function a(t){return n(h(t))}function s(){if(v.frequencyElm&&(v.frequencyElm.innerHTML=o(Math.round(g.frequency),4)+" Hz"),v.noteElm){var t=a(g.frequency);v.noteElm.innerHTML=t,synth.triggerAttackRelease(t,"10n")}}function d(){var t=0,e,i,r=2*Math.PI;this.samplingRate=44100,i=1/this.samplingRate,this.pitchBase=50,this.pitchBend=0,this.pitchRange=2e3,this.volume=.5,this.maxVolume=.5,this.frequency=this.pitchBase,e=this.pitchBase,this.getBuffer=function(o){for(var n=[],h=this.volume*this.maxVolume,a=0;a<o;a++)for(n[a]=h*Math.sin(t*r),t+=e*i;t>1;)t-=1},this.setPitchBend=function(t){this.pitchBend=t,this.frequency=this.pitchBase+this.pitchBend*this.pitchRange,e=this.frequency}}function c(t){var e=t.outputBuffer,i=e.getChannelData(0),r=e.getChannelData(1),o=i.length,n=[];if(farbe1){n=g.getBuffer(o);for(var h=0;h<n.length;h++)i[h]=n[h],r[h]=n[h]}else for(var h=0;h<o;h++)i[h]=0,r[h]=0}function u(){g=new d,f=new AudioContext,m=f.createScriptProcessor(4096),m.onaudioprocess=c,m.connect(f.destination)}function l(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}var f,m,g,v={};e(),window.onload=function(){e(),i();try{u()}catch(t){console.log(t),alert("Your browser does not support webkitAudioContext")}};var w={doLoad:function(){var t=this;this.video=v.webcamElm,this.mirrorVideo=v.webcamMirror,this.mirrorVideoCtx=this.mirrorVideo.getContext("2d"),this.twElement=v.trackedElm,this.pageLoaded=!0,this.startPlayer()},videoIsPlaying:function(){this.timerCallback()},videoIsReady:function(){this.videoLoaded=!0,this.startPlayer()},startPlayer:function(){this.videoLoaded&&this.pageLoaded&&(this.width=this.video.width,this.height=this.video.height,this.mirrorVideo.width=this.width,this.mirrorVideo.height=this.height,this.mirrorVideoCtx.fillStyle="white",this.mirrorVideoCtx.strokeStyle="black",this.mirrorVideoCtx.translate(this.mirrorVideo.width,0),this.mirrorVideoCtx.scale(-1,1),this.playVideo())},playVideo:function(){this.video.play(),this.videoIsPlaying()},stopVideo:function(){this.video.pause(),clearTimeout(this.timeout)},timerCallback:function(){if(!this.video.paused&&!this.video.ended){this.computeFrame();var t=this;this.timeout=setTimeout(function(){t.timerCallback()},50)}},dist:function(t,e,i,r){return Math.sqrt((t-i)*(t-i)+(e-r)*(e-r))},computeFrame:function(){var t=l(v.color),e=t.r,i=t.g,r=t.b,o=v.sizeOffset,n=v.cOffset;this.mirrorVideoCtx.clearRect(0,0,this.width,this.height);try{this.mirrorVideoCtx.drawImage(this.video,0,0,this.width,this.height)}catch(t){return}for(var h=this.mirrorVideoCtx.getImageData(0,0,this.width,this.height),a,d,c=null,u,f,m,a,d,w=20,y=h.data.length/4,p=4,b=0;b<y;b+=4)if(u=h.data[4*b+0],f=h.data[4*b+1],m=h.data[4*b+2],a=b%this.width,d=Math.round(b/this.width),u>e-n&&u<e+n&&f>i-n&&f<i+n&&m>r-n&&m<r+n)if(c){var x=this.dist(a,d,c.x,c.y);x<w&&(c.x+=1/(c.weight+1)*(a-c.x),c.y+=1/(c.weight+1)*(d-c.y),c.rgb=u+","+f+","+m,c.weight++)}else c={},c.x=a,c.y=d,c.rgb=u+","+f+","+m,c.weight=1;if(!c)return void(farbe1=!1);c.weight>o?(this.twElement.style.top=c.y+"px",this.twElement.style.left=c.x+"px",this.twElement.style.backgroundColor="rgb("+c.rgb+")",farbe1=!0,g.setPitchBend(c.x/this.width),g.volume=1-c.y/this.height,s()):farbe1=!1}},y={init:function(t){r(v,t),w.doLoad(),w.videoIsReady()},set:function(t,e){v[t]=e}};t.ARSynth=y}(window);